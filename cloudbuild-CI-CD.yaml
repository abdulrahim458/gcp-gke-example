# In this directory, run the following command to build this builder.
# $ gcloud container builds submit . --config=cloudbuild.yaml

steps:

- name: 'gcr.io/cloud-builders/docker'
  id: 'Build application and container'
  args:
  - 'build'
  - '-t'
  - 'gcr.io/$PROJECT_ID/nodejs'
  - '.'

- name: 'gcr.io/cloud-builders/docker'
  id: 'Push image to Container Registry'
  args:
  - 'push'
  - 'gcr.io/$PROJECT_ID/nodejs'

- name: 'gcr.io/cloud-builders/kubectl'
  id: 'Deploy to Kubernetes Cluster'
  args: ['./deploy.sh']

options:
  logging: CLOUD_LOGGING_ONLY